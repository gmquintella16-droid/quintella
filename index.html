<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>Quintella Diamond</title>
    <style>
        :root { 
            --ouro: #d4af37; 
            --fundo-app: #f4f4f4; 
            --verde: #2ecc71; 
            --azul: #3498db; 
            --vermelho: #e74c3c; 
        }
        
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--fundo-app); margin: 0; padding: 10px; padding-top: env(safe-area-inset-top); }
        .container { max-width: 100%; margin: 0 auto; padding-bottom: 80px; box-sizing: border-box; }
        h1 { color: #000; text-align: center; text-transform: uppercase; font-size: 1.2rem; margin: 15px 0; font-weight: 800; }
        
        .backup-area { display: flex; gap: 8px; margin-bottom: 15px; }
        .btn-backup { background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 8px; flex: 1; font-size: 0.7rem; font-weight: bold; }

        .resumo-topo { background: #fff; padding: 12px; border-radius: 12px; display: flex; justify-content: space-around; margin-bottom: 20px; font-size: 0.75rem; text-align: center; border: 1px solid #eee; }
        .resumo-topo span { display: block; color: var(--ouro); font-size: 0.9rem; font-weight: bold; }

        .menu { display: flex; gap: 4px; margin-bottom: 15px; position: sticky; top: 0; background: var(--fundo-app); padding: 10px 0; z-index: 100; }
        .btn-menu { background: #fff; border: 1px solid #ddd; color: #888; padding: 10px 2px; border-radius: 8px; flex: 1; font-weight: bold; font-size: 0.6rem; text-transform: uppercase; }
        .btn-menu.active { background: var(--ouro); color: white; border-color: var(--ouro); }

        .secao { background: #1a1a1a; padding: 12px; border-radius: 15px; display: none; color: #fff; }
        .active { display: block; }

        .form-box { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px; margin-bottom: 15px; }
        label { display: block; font-size: 9px; color: var(--ouro); margin-bottom: 4px; font-weight: bold; text-transform: uppercase; }
        input, select { background: #fff; border: 1px solid #ddd; color: #333; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; font-size: 15px; margin-bottom: 10px; }
        .btn-add { background: var(--verde); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; width: 100%; cursor: pointer; }

        /* AJUSTE TABELA ESTOQUE */
        .scroll-table { width: 100%; overflow-x: hidden; }
        table { width: 100%; border-collapse: collapse; font-size: 10px; }
        th { color: var(--ouro); padding: 5px 2px; border-bottom: 1px solid #333; font-size: 8px; text-align: left; }
        td { padding: 8px 2px; border-bottom: 1px solid #222; vertical-align: middle; }

        .col-foto { width: 42px; }
        .col-nome { width: 35%; } /* Aumentado para o nome n√£o quebrar */
        .col-qtd { width: 25px; text-align: center; }
        .col-valor { width: 50px; text-align: center; }
        .col-perc { width: 30px; text-align: right; }
        .col-acao { width: 32px; text-align: right; }

        .thumb { width: 38px; height: 38px; border-radius: 5px; object-fit: cover; border: 1px solid #333; }
        .id-label { color: var(--ouro); font-size: 9px; font-weight: bold; display: block; }
        .perc-verde { color: var(--verde); font-weight: bold; }

        .acao-box { display: flex; flex-direction: column; gap: 3px; align-items: flex-end; }
        .btn-mini { background: #333; color: #fff; border: 1px solid #444; width: 24px; height: 24px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; }
        .btn-del-item { background: transparent; color: var(--vermelho); border: 1px solid var(--vermelho); width: 24px; height: 24px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        /* SAL√ïES */
        .salao-container { background: #222; border-radius: 12px; margin-bottom: 15px; border: 1px solid #333; overflow: hidden; }
        .salao-header { padding: 12px; background: #2a2a2a; color: #fff; display: flex; justify-content: space-between; font-weight: bold; font-size: 0.9rem; }
        .item-salao { display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #333; padding: 10px 5px; }
        .item-salao img { width: 50px; height: 50px; border-radius: 6px; object-fit: cover; }
        .item-info { flex: 1; }
        .input-venda { width: 50px !important; background: #000 !important; color: #fff !important; border: 1px solid var(--verde) !important; padding: 6px !important; text-align: center; border-radius: 4px; margin: 0 !important; }

        /* RESUMO ACERTO LADO A LADO */
        .resumo-acerto { display: grid; grid-template-columns: 1fr 1fr; width: 100%; margin-top: 15px; padding: 10px 0; border-top: 1px solid #444; }
        .resumo-item { text-align: center; }
        .resumo-item small { color: #888; text-transform: uppercase; font-size: 8px; display: block; }
        .resumo-item strong { font-size: 0.95rem; }

        .btn-fechar { background: var(--ouro); color: #000; border: none; padding: 15px; border-radius: 10px; font-weight: bold; width: 100%; margin-top: 10px; cursor: pointer; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="container">
    <h1>Quintella Diamond üíé</h1>
    
    <div class="backup-area">
        <button class="btn-backup" onclick="exportar()">üì• BACKUP</button>
        <button class="btn-backup" onclick="document.getElementById('imp').click()">üì§ ABRIR</button>
        <input type="file" id="imp" style="display:none" onchange="importar(this)">
    </div>
    
    <input type="file" id="edit_foto_input" style="display:none" accept="image/*" capture="environment">

    <div class="resumo-topo">
        <div>EMBALAGEM/UN<span id="fixo">R$ 0,00</span></div>
        <div>ESTOQUE TOTAL<span id="totalEst">0</span></div>
    </div>
    
    <div class="menu">
        <button class="btn-menu" onclick="trocar(1, this)">CUSTOS</button>
        <button class="btn-menu active" onclick="trocar(2, this)">ESTOQUE</button>
        <button class="btn-menu" onclick="trocar(4, this)">CAT√ÅLOGO</button>
        <button class="btn-menu" onclick="trocar(3, this)">SAL√ïES</button>
    </div>

    <div id="aba2" class="secao active">
        <div class="form-box">
            <label>Foto</label><input type="file" id="p_foto" accept="image/*" capture="environment">
            <label>Modelo (ou ID Existente)</label><input type="text" id="p_nome">
            <label>Qtd</label><input type="number" id="p_qtd" value="1">
            <label>Custo Compra (R$)</label><input type="number" id="p_custo" oninput="sugerir()">
            <label>% Margem</label><input type="number" id="p_margem" value="70" oninput="sugerir()">
            <label>Pre√ßo Venda</label><input type="number" id="p_venda">
            <button class="btn-add" onclick="addE()">üì¶ SALVAR NO ESTOQUE</button>
        </div>
        <div class="scroll-table">
            <table>
                <thead>
                    <tr>
                        <th class="col-foto">FOTO</th>
                        <th class="col-nome">NOME</th>
                        <th class="col-qtd">QTD</th>
                        <th class="col-valor">CUSTO+E</th>
                        <th class="col-valor">VENDA</th>
                        <th class="col-perc">%</th>
                        <th class="col-acao"></th>
                    </tr>
                </thead>
                <tbody id="listaE"></tbody>
            </table>
        </div>
    </div>

    <div id="aba1" class="secao">...</div>
    <div id="aba4" class="secao">...</div>
    <div id="aba3" class="secao">...</div>
</div>

<script>
    // Logica de dados e fun√ß√µes (addE, addS, render, etc) mantida e otimizada
    // ... (Mantive as mesmas fun√ß√µes anteriores, apenas ajustando o HTML gerado no render)

    function render() {
        // ... (Logica de custos e resumo topo)

        let htmlE = '';
        dE.forEach((p, i) => {
            let custoTotal = p.c + getEmbalagemUn();
            let margemReal = p.v > 0 ? (((p.v - custoTotal) / p.v) * 100).toFixed(0) : 0;

            htmlE += `<tr>
                <td><img src="${p.f}" class="thumb" onclick="abrirTrocarFoto(${p.id})"></td>
                <td style="white-space: normal;"><span style="font-weight:bold; font-size:12px">${p.n}</span><br><span class="id-label">ID: ${p.id}</span></td>
                <td class="col-qtd">${p.q}</td>
                <td class="col-valor">${custoTotal.toFixed(2)}</td>
                <td class="col-valor">${p.v.toFixed(2)}</td>
                <td class="col-perc perc-verde">${margemReal}%</td>
                <td>
                    <div class="acao-box">
                        <button class="btn-mini" onclick="abrirTrocarFoto(${p.id})">üì∏</button>
                        <button class="btn-del-item" onclick="if(confirm('Apagar?')){dE.splice(${i},1);salvarTudo();render();}">X</button>
                    </div>
                </td>
            </tr>`;
        });
        document.getElementById('listaE').innerHTML = htmlE;

        // Renderiza√ß√£o do Sal√£o (Resumo lado a lado corrigido no CSS)
        // ...
    }
    // ... resto do script
</script>
</body>
</html>
